name: Binaries
on: 
  push:
    branches:
      - main
env:
  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

jobs:
  BuildBDSWeb:
    strategy:
      matrix:
        os:
          - ubuntu-latest
          - windows-latest
          - macos-latest
          - ARM64
    runs-on: "${{ matrix.os }}"
    name: "System ${{ matrix.os }}"
    steps:
      - name: Setup NodeJS
        uses: actions/setup-node@v2.1.5
        with:
          node-version: 16.x

      - name: Install NASM (Windows)
	if: matrix.os == "windows-latest"
	uses: ilammy/setup-nasm@v1.2.0

      - name: Install Arm64 Dependecies
	if: matrix.os == "ARM64"
	run: |
	  sudo apt update
	  sudo apt install -y python python3 g++ build-essential make ca-certificates wget curl dpkg-dev unzip zip jq git

      - name: Checkout Repository
        uses: actions/checkout@master

      - name: NPM Install packages
        run: npm install --no-save

      - name: Build Bds Maneger with Nexe
        run: npm run nexe
      
      - name: Releases
        uses: softprops/action-gh-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          name: "The Bds Maneger Release"
          tag_name: "Bds_Maneger_${{ github.run_id }}"
          files: "Bds_Maneger_Bin-*"
          body: "${{ matrix.os }}"
